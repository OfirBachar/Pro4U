<!DOCTYPE html>
<html>
{% load static %}

{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="{% static 'css/search.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="filters">
        <label class="head-line-label" for="filters">Please search professional by one or more from the following
            filters:</label>
        <form method="post">
            {% csrf_token %}
            <div class="filter-box">
                <input type="number" name="professional_id" class="professional_id" placeholder="Professional ID" />
            </div>
            <div class="filter-box">
                <input type="text" name="profession" class="profession" placeholder="Profession" />
            </div>
            <div class="filter-box">
                <input type="text" name="first_name" class="first_name" placeholder="First_name" />
            </div>
            <div class=" filter-box">
                <input type="text" name="last_name" class="last_name" placeholder="Last_name" />
            </div>
            <div class="filter-box">
                <input type="text" name="city" class="city" placeholder="City" />
            </div>
            <button class="search-btn" type="submit">Search</button>
        </form>
    </div>
    <div class="search-results">
        <label class="head-line-label" for="search-results">Search results:</label>
        <div class="professional-grid">
            {% for professional in professionals.all %}
            <div class="professional-box" id="professional-{{ professional.professional_id }}">
                <p>Professional ID: {{ professional.professional_id }}</p>
                <p>Profession: {{ professional.get_profession_display }}</p>
                <p>First name: {{ professional.profile_id.user_id.first_name }}</p>
                <p>Last name: {{ professional.profile_id.user_id.last_name }}</p>
                <p>City: {{ professional.profile_id.city }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="search-history">
        <label class="head-line-label" for="search-history">Last 5 Search History:</label>
        <div class="search-history-grid">
            {% for search in last_searches.all %}
            <div class="search-history-box">
                <p>Professional ID: {{ search.professional_id.professional_id }}</p>
                <p>Profession: {{ search.professional_id.get_profession_display }}</p>
                <p>First Name: {{ search.professional_id.profile_id.user_id.first_name }}</p>
                <p>Last Name: {{ search.professional_id.profile_id.user_id.last_name }}</p>
                <p>City: {{ search.professional_id.profile_id.city }}</p>
                <p>Date: {{ search.date }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-s9lT2w4UDTe8rDwWyTtHofbFH3fa6zvVnfwBlyUtdS+mxL/M9aQjvI99vHYMtoVw"
    crossorigin="anonymous"></script>

<!-- <script>
        function handleProfessionalBoxClick(professionalId) {
        var urlParams = new URLSearchParams(window.location.search);
        var user_id = urlParams.get('user_id');

        // Make an AJAX request to the server
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/create_search_history/');
        xhr.setRequestHeader('Content-Type', 'application/json');

        // Send the data to the server
        var data = JSON.stringify({
            client_id: user_id,
            professional_id: professionalId
        });
        xhr.send(data);
    }

    // Add click event listeners to professional boxes
    var professionalBoxes = document.getElementsByClassName('professional-box');
    for (var i = 0; i < professionalBoxes.length; i++) {
        professionalBoxes[i].addEventListener('click', function(event) {
            var professionalId = event.currentTarget.id.replace('professional-', '');
            handleProfessionalBoxClick(professionalId);
        });
    } -->
</script>
{% endblock %}

</html>